<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mediator ‚Ä¢ Warehouse</title>
<link rel="stylesheet" href="/styles.css" />

<header class="header">
  <div class="nav">
    <div class="brand"><a href="/">Mediator</a></div>
    <nav style="margin-left:auto;display:flex;gap:12px">
      <a href="#find">Find</a>
      <a href="#boxes">Boxes</a>
      <a href="#activity">Activity</a>
      <a href="#import">Import</a>
    </nav>
  </div>
</header>

<div class="container">
  <h1>Overview</h1>
  <div class="grid landing-grid">
    <div class="card">
      <h2>Navigation & Overview</h2>
      <ul>
        <li><a href="/">üè† Landing</a> ‚Äî this page</li>
        <li><a href="/api/overview">üìä API: Overview</a> ‚Äî counts, recent boxes & activity (JSON)</li>
        <li><a href="/api/boxes">üì¶ API: List Boxes</a></li>
        <li><a href="/api/search?material=A-1001">üîç API: Search Items (by material)</a></li>
        <li><a href="/api/items/ITEM-UUID-HERE">üìÑ API: Item detail (replace UUID)</a></li>
        <li><a href="/api/export/wms">‚¨áÔ∏è API: Export snapshot for WMS</a></li>
        <li><a href="ui/box/BOX-ID-HERE">üìç Box placement page (replace BoxID)</a></li>
        <li><a href="/ui/box/BOX-ID-HERE">üß≠ UI Action View for Box (replace BoxID)</a></li>
        <li><a href="/ui/item/ITEM-UUID-HERE">üß≠ UI Action View for Item (replace UUID)</a></li>
        <li><a href="/qr/ITEM-UUID-HERE">üîó QR redirect (to WMS if link exists)</a></li>
      </ul>
      <p class="muted">Replace <code>BOX-ID-HERE</code> or <code>ITEM-UUID-HERE</code> with real values from your
        database or CSV imports.</p>
    </div>

    <div class="card">
      <h2 id="find">Find items</h2>
      <div class="row">
        <input id="mat" placeholder="Material number e.g. A-12345" autofocus />
        <button class="btn" id="btnSearch">Search</button>
      </div>
      <div class="row-3">
        <input id="goId" placeholder="BOX-2025-0001 or Item UUID" />
        <select id="goType">
          <option value="box">Box</option>
          <option value="item">Item</option>
        </select>
        <button class="btn" id="btnOpen">Open</button>
      </div>
      <div id="searchOut" class="list"></div>
    </div>

    <div class="card">
      <h2>Stats</h2>
      <div id="stats" class="list">
        <div class="muted">Loading‚Ä¶</div>
      </div>
      <div class="muted">Health: <span id="health">checking‚Ä¶</span></div>
    </div>

    <div class="card" id="import">
     <a class="linkcard" href="/ui/import">
  <div class="card">
    <h2>Daten Eingabe</h2>
    <p class="muted">Einzelnes Teil erfassen oder CSV-Datei hochladen.</p>
  </div>
</a>
    </div>

    <!-- <div class="card">
      <h2>Shortcuts</h2>
      <div class="inline"><span class="kbd">/</span> focus search</div>
      <div class="inline"><span class="kbd">Enter</span> run search / open</div>
      <div class="inline"><span class="kbd">b</span> open Box view field</div>
      <div class="inline"><span class="kbd">i</span> open Item view field</div>
    </div> -->

    <div class="card">
      <h2 id="boxes">Recent boxes</h2>
      <div id="boxesOut" class="list">
        <div class="muted">Loading‚Ä¶</div>
      </div>
    </div>

    <div class="card">
      <h2 id="activity">Recent activity</h2>
      <div id="eventsOut" class="list">
        <div class="muted">Loading‚Ä¶</div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  function $(id){ return document.getElementById(id); }

  async function health() {
    const el = $('health'); if (!el) return;
    try {
      const r = await fetch('/');
      el.textContent = r.ok ? 'OK' : ('HTTP ' + r.status);
      el.className = r.ok ? 'ok' : 'err';
    } catch { el.textContent = 'unreachable'; el.className = 'err'; }
  }

  async function overview() {
    const statsEl = $('stats'), boxesEl = $('boxesOut'), evEl = $('eventsOut');
    if (!statsEl || !boxesEl || !evEl) return;
    try {
      const r = await fetch('/api/overview');
      const d = await r.json();
      statsEl.innerHTML = `
        <div>Total boxes: <b>${d.counts.boxes}</b></div>
        <div>Total items: <b>${d.counts.items}</b></div>
        <div>Items ohne WMS-Link: <b>${d.counts.itemsNoWms}</b></div>
      `;
      boxesEl.innerHTML = (d.recentBoxes||[]).length
        ? d.recentBoxes.map(x => `
            <div class="card">
              <div><a href="/ui/box/${encodeURIComponent(x.BoxID)}"><b>${x.BoxID}</b></a></div>
              <div class="muted">Location: ${x.Location || '(unset)'} ¬∑ Updated: ${x.UpdatedAt || ''}</div>
            </div>`).join('')
        : '<div class="muted">No boxes yet.</div>';
      evEl.innerHTML = (d.recentEvents||[]).length
        ? d.recentEvents.map(e => `
            <div class="card">
              <div><span class="pill">${e.EntityType}</span> <b class="mono">${e.EntityId}</b></div>
              <div>${e.CreatedAt} ‚Äî ${e.Event} ${e.Actor ? 'by '+e.Actor : ''}</div>
            </div>`).join('')
        : '<div class="muted">No recent activity.</div>';
    } catch {
      statsEl.innerHTML = '<div class="muted">Failed to load overview</div>';
      boxesEl.innerHTML = '';
      evEl.innerHTML = '';
    }
  }

  async function search() {
    const input = $('mat'), out = $('searchOut');
    if (!input || !out) return;
    const q = input.value.trim();
    out.innerHTML = '';
    if (!q) return;
    const r = await fetch('/api/search?material=' + encodeURIComponent(q));
    const data = await r.json();
    out.innerHTML = (data.items||[]).length
      ? data.items.map(it => `
          <div class="card">
            <div><b>${it.MaterialNumber || '(no material)'}</b> ¬∑ <span class="pill mono">${(it.ItemUUID||'').slice(-6).toUpperCase()}</span></div>
            <div class="muted">${it.Description || ''}</div>
            <div>Box: <a class="mono" href="/ui/box/${encodeURIComponent(it.BoxID)}">${it.BoxID}</a></div>
            <div><a class="mono" href="/ui/item/${encodeURIComponent(it.ItemUUID)}">Open item ‚Üí</a></div>
          </div>`).join('')
      : '<div class="muted">No items found.</div>';
  }

  // Bind safely (only if elements exist)
  const btnSearch = $('btnSearch');
  if (btnSearch) btnSearch.addEventListener('click', search);
  const mat = $('mat');
  if (mat) mat.addEventListener('keydown', (e) => { if (e.key === 'Enter') search(); });

  // Shortcuts only if inputs exist
  document.addEventListener('keydown', (e) => {
    if (e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA') {
      if (mat) { e.preventDefault(); mat.focus(); }
    }
    if (e.key === 'Enter' && document.activeElement === mat) search();
  });

  health(); overview();
})();
</script>


</html>