version: '3.9'

services:
  mediator:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mediator
    ports:
      - "8080:8080"
      # Uncomment the following line to expose the optional HTTPS listener once TLS_CERT_PATH/TLS_KEY_PATH are configured.
      # - "8443:8443"
    environment:
      # Storage locations for persistent state.
      DB_PATH: /var/lib/mediator/mediator.sqlite
      INBOX_DIR: /var/lib/mediator/inbox
      ARCHIVE_DIR: /var/lib/mediator/archive
      # Set to the externally reachable hostname or IP for generated links.
      PUBLIC_HOSTNAME: localhost
      # Additional environment variables may be supplied here to override defaults from backend/config.ts,
      # such as HTTP_PORT, HTTPS_PORT, PUBLIC_PORT, PUBLIC_ORIGIN, BASE_QR_URL, BASE_UI_URL, PUBLIC_PROTOCOL, etc.
      # Configure printing by setting PRINTER_QUEUE (and optionally LP_COMMAND / LPSTAT_COMMAND / PRINT_TIMEOUT_MS).
      # The in-process agentic orchestrator reuses these defaults; provide provider-specific overrides or secrets via an env_file.
      AGENTIC_MODEL_PROVIDER: ollama
      AGENTIC_OLLAMA_BASE_URL: http://127.0.0.1:11434
      AGENTIC_OLLAMA_MODEL: qwen3:0.6b
      # Uncomment to enable OpenAI-compatible providers and inject credentials through env_file or secrets management.
      # AGENTIC_OPENAI_API_KEY: ""
      AGENTIC_OPENAI_BASE_URL: https://api.openai.com/v1
      AGENTIC_OPENAI_MODEL: gpt-4o-mini
      AGENTIC_SEARCH_BASE_URL: http://127.0.0.1
      AGENTIC_SEARCH_PORT: 8000
      AGENTIC_SEARCH_PATH: /search
      AGENTIC_QUEUE_POLL_INTERVAL_MS: 5000
      # Provide API keys for third-party enrichment separately.
      # TAVILY_API_KEY: ""
      SEARCH_WEB_ALLOWED_ENGINES: google,duckduckgo,brave
    volumes:
      # Persist the mediator application state and inbox/archive content.
      - mediator-data:/var/lib/mediator
      # Persist generated media assets served by the backend.
      - mediator-media:/app/dist/backend/media
      # Optional: mount TLS key/cert files and set TLS_CERT_PATH/TLS_KEY_PATH when enabling HTTPS support.
      # - ./secrets/tls/server.crt:/etc/mediator/tls/server.crt:ro
      # - ./secrets/tls/server.key:/etc/mediator/tls/server.key:ro
      # Optional: mount printer configuration files or device mappings if required for the target printer setup.
      # - ./config/printers:/etc/mediator/printers:ro
    restart: unless-stopped

volumes:
  mediator-data:
    name: mediator-data
  mediator-media:
    name: mediator-media
